import os
import random
import sqlite3
from datetime import datetime

from datetime import datetime, timezone, timedelta
from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, ContextTypes, MessageHandler, filters

# -----------------------------
# 1ï¸âƒ£ Ð¢Ð¾ÐºÐµÐ½
# -----------------------------
TOKEN = os.getenv("TOKEN")
if not TOKEN:
    raise ValueError("Ð¢Ð¾ÐºÐµÐ½ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½! ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Environment Variables Ð½Ð° Railway")
TOKEN = TOKEN.strip()

# -----------------------------
# 2ï¸âƒ£ ÐŸÐ°Ð¿ÐºÐ° Ñ Ñ„Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ð¸ÑÐ¼Ð¸
# -----------------------------
PHOTOS_DIR = "photos"
photo_files = os.listdir(PHOTOS_DIR)
photo_files = [f for f in photo_files if f.endswith(".jpg")]
if not photo_files:
    raise ValueError("Ð’ Ð¿Ð°Ð¿ÐºÐµ photos Ð½ÐµÑ‚ jpg Ñ„Ð°Ð¹Ð»Ð¾Ð²!")
photo_files.sort()
# -----------------------------
# 3ï¸âƒ£ Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ„Ñ€Ð°Ð·
# -----------------------------
PHRASES = [
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ñ‚Ñ‹ Ð½ÐµÐ²ÐµÑ€Ð¾ÑÑ‚Ð½Ð°Ñ, Ð½Ðµ Ð·Ð°Ð±Ñ‹Ð²Ð°Ð¹ Ð¾Ð± ÑÑ‚Ð¾Ð¼ ðŸŒ¸",
    "Ð”Ñ‹ÑˆÐ¸ Ð³Ð»ÑƒÐ±Ð¾ÐºÐ¾, Ð²ÑÑ‘ Ð½Ð°Ð»Ð°Ð´Ð¸Ñ‚ÑÑ, Ñ Ð²ÐµÑ€ÑŽ Ð² Ñ‚ÐµÐ±Ñ â¤ï¸",
    "Ð¢Ñ‹ ÑÐ¸Ð»ÑŒÐ½Ð°Ñ, ÑÐ¼ÐµÐ»Ð°Ñ Ð¸ Ð·Ð°Ð¼ÐµÑ‡Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ, Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ° ðŸŒˆ",
    "ÐÐµ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°Ð¹ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ ÑÐ¸Ð»ÑŒÐ½Ð¾, Ð¼Ð¸Ñ€ Ð»ÑŽÐ±Ð¸Ñ‚ Ñ‚ÐµÐ±Ñ ðŸŒ¼",
    "ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ â€” Ð½Ð¾Ð²Ð°Ñ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ, Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ° âœ¨",
    "Ð¢Ñ‹ Ð·Ð°ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°ÐµÑˆÑŒ ÑÑ‡Ð°ÑÑ‚ÑŒÑ Ð¸ Ñ‚ÐµÐ¿Ð»Ð°, Ð½Ðµ Ð·Ð°Ð±Ñ‹Ð²Ð°Ð¹ ðŸŒ·",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ð¿Ð¾Ð¼Ð½Ð¸, Ñ‡Ñ‚Ð¾ Ñ‚Ð²Ð¾Ð¸ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð° Ð²Ð°Ð¶Ð½Ñ‹ Ð¸ Ð¸Ñ… Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾Ñ‚Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ðŸ’›",
    "Ð¢Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð²ÑÑ‘, Ñ‡Ñ‚Ð¾ Ð·Ð°Ð´ÑƒÐ¼Ð°Ð»Ð°, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ð¾Ð²ÐµÑ€ÑŒ Ð² ÑÐµÐ±Ñ ðŸ’«",
    "Ð¡Ð¼ÐµÐ¹ÑÑ, Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ñ‚Ñ€ÑƒÐ´Ð½Ð¾, Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ° ðŸ˜º",
    "Ð¢Ñ‹ Ð´ÐµÐ»Ð°ÐµÑˆÑŒ Ð¼Ð¸Ñ€ ÑÑ€Ñ‡Ðµ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð±ÑƒÐ´ÑŒ ÑÐ¾Ð±Ð¾Ð¹ ðŸŒŸ",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ð²ÑÑ‘, Ñ‡Ñ‚Ð¾ Ñ‚ÐµÐ±Ñ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð¸Ñ‚, Ð¿Ñ€Ð¾Ð¹Ð´Ñ‘Ñ‚ ðŸ•Šï¸",
    "ÐÐµ ÑÐ¿ÐµÑˆÐ¸, Ð´Ñ‹ÑˆÐ¸ Ð¸ Ð´ÐµÐ»Ð°Ð¹ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ðµ ÑˆÐ°Ð³Ð¸ ðŸŒ¸",
    "Ð¢Ñ‹ ÑƒÐ¶Ðµ Ð¿Ñ€Ð¾Ð´ÐµÐ»Ð°Ð»Ð° Ð¾Ð³Ñ€Ð¾Ð¼Ð½ÑƒÑŽ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ, Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ° ðŸ‘",
    "Ð›ÑŽÐ±Ð¾Ð¹ ÑˆÑ‚Ð¾Ñ€Ð¼ Ð·Ð°ÐºÐ°Ð½Ñ‡Ð¸Ð²Ð°ÐµÑ‚ÑÑ, Ð¸ ÑÐ¾Ð»Ð½Ñ†Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð²Ñ‹Ð¹Ð´ÐµÑ‚ â˜€ï¸",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ð·Ð½Ð°Ð¹: Ñ‚Ð²Ð¾Ñ Ð´Ð¾Ð±Ñ€Ð¾Ñ‚Ð° Ð´ÐµÐ»Ð°ÐµÑ‚ ÑÑ‚Ð¾Ñ‚ Ð¼Ð¸Ñ€ Ð»ÑƒÑ‡ÑˆÐµ ðŸ’–",
    "Ð¢Ñ‹ ÑƒÐ¼ÐµÐµÑˆÑŒ ÑÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒÑÑ Ñ Ñ‚Ñ€ÑƒÐ´Ð½Ð¾ÑÑ‚ÑÐ¼Ð¸, Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ ÑÐµÐ¹Ñ‡Ð°Ñ Ñ‚ÑÐ¶ÐµÐ»Ð¾ ðŸŒ·",
    "ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑŒ ÑÐµÐ±Ðµ Ð¾Ñ‚Ð´Ð¾Ñ…Ð½ÑƒÑ‚ÑŒ Ð¸ ÑƒÐ»Ñ‹Ð±Ð½ÑƒÑ‚ÑŒÑÑ ðŸ˜Š",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ñ‚Ñ‹ Ð·Ð°ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°ÐµÑˆÑŒ Ð»ÑŽÐ±Ð²Ð¸ Ð¸ Ð·Ð°Ð±Ð¾Ñ‚Ñ‹ ðŸŒ¹",
    "ÐšÐ°Ð¶Ð´Ð¾Ðµ Ñ‚Ð²Ð¾Ðµ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¾ Ð²Ð°Ð¶Ð½Ð¾, Ð½Ðµ Ð¿Ð¾Ð´Ð°Ð²Ð»ÑÐ¹ ÐµÐ³Ð¾ ðŸ’›",
    "Ð¢Ñ‹ Ð½Ðµ Ð¾Ð´Ð½Ð°, Ð¼Ð¸Ñ€ Ð¸ Ñ Ñ Ñ‚Ð¾Ð±Ð¾Ð¹ ðŸŒˆ",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, ÑÐµÐ³Ð¾Ð´Ð½Ñ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ð¹ Ð´ÐµÐ½ÑŒ Ð´Ð»Ñ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ð¹ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸ ðŸ€",
    "Ð¢Ñ‹ Ñ‚Ð°Ð»Ð°Ð½Ñ‚Ð»Ð¸Ð²Ð°, ÑƒÐ¼Ð½Ð° Ð¸ Ð¿Ñ€ÐµÐºÑ€Ð°ÑÐ½Ð° ðŸŒŸ",
    "ÐÐµ Ð±Ð¾Ð¹ÑÑ Ð¾ÑˆÐ¸Ð±Ð¾Ðº, Ð¾Ð½Ð¸ Ð´ÐµÐ»Ð°ÑŽÑ‚ Ñ‚ÐµÐ±Ñ ÑÐ¸Ð»ÑŒÐ½ÐµÐµ ðŸ’«",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, ÑƒÐ»Ñ‹Ð±Ð½Ð¸ÑÑŒ, Ð´Ð°Ð¶Ðµ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ°Ñ ÑƒÐ»Ñ‹Ð±ÐºÐ° â€” ÑÑ‚Ð¾ Ð¼Ð°Ð³Ð¸Ñ ðŸ˜º",
    "Ð¢Ñ‹ ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð° Ð½Ð° Ð±Ð¾Ð»ÑŒÑˆÐµÐµ, Ñ‡ÐµÐ¼ Ð´ÑƒÐ¼Ð°ÐµÑˆÑŒ ðŸŒ¼",
    "Ð’ÑÑ‘ Ð±ÑƒÐ´ÐµÑ‚ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð´Ð¾Ð²ÐµÑ€ÑÐ¹ ÑÐµÐ±Ðµ ðŸŒ·",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ñ‚Ñ‹ ÑƒÐ´Ð¸Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ, Ð½Ðµ ÑÐ¾Ð¼Ð½ÐµÐ²Ð°Ð¹ÑÑ ðŸŒ¸",
    "ÐŸÑƒÑÑ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð¼Ð¸Ð½ÑƒÑ‚ÐºÐ° Ð¿Ð¾ÐºÐ¾Ñ Ð¸ Ñ‚ÐµÐ¿Ð»Ð° ðŸ’–",
    "Ð¢Ñ‹ ÑƒÐ¼ÐµÐµÑˆÑŒ ÑÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒÑÑ Ñ Ð»ÑŽÐ±Ñ‹Ð¼Ð¸ Ð±ÑƒÑ€ÑÐ¼Ð¸, Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ° ðŸ•Šï¸",
    "ÐŸÐ¾Ð¼Ð½Ð¸, Ñ‡Ñ‚Ð¾ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ðµ Ð¿Ð¾Ð±ÐµÐ´Ñ‹ â€” ÑÑ‚Ð¾ Ñ‚Ð¾Ð¶Ðµ ÑƒÑÐ¿ÐµÑ… ðŸŒŸ",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑŒ ÑÐµÐ±Ðµ Ð¿Ð¾Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½Ñ ðŸ˜Š",
    "Ð¢Ñ‹ Ð´Ð¾ÑÑ‚Ð¾Ð¹Ð½Ð° ÑÐ°Ð¼Ñ‹Ñ… Ñ‚Ñ‘Ð¿Ð»Ñ‹Ñ… ÑÐ»Ð¾Ð² Ð¸ Ð¾Ð±ÑŠÑÑ‚Ð¸Ð¹ ðŸ’›",
    "Ð”Ð°Ð¶Ðµ Ð² Ñ‚Ñ€ÑƒÐ´Ð½Ñ‹Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹ Ñ‚Ñ‹ Ð¾ÑÑ‚Ð°Ñ‘ÑˆÑŒÑÑ Ð¿Ñ€ÐµÐºÑ€Ð°ÑÐ½Ð¾Ð¹ ðŸŒ·",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ñ‚Ð²Ð¾Ñ ÑÐ½ÐµÑ€Ð³Ð¸Ñ Ð´ÐµÐ»Ð°ÐµÑ‚ ÑÑ‚Ð¾Ñ‚ Ð¼Ð¸Ñ€ ÑÐ²ÐµÑ‚Ð»ÐµÐµ âœ¨",
    "Ð”Ð¾Ð²ÐµÑ€ÑÐ¹ ÑÐµÐ±Ðµ, Ñ‚Ñ‹ Ð²ÑÑ‘ ÑÐ¼Ð¾Ð¶ÐµÑˆÑŒ ðŸ’«",
    "Ð¢Ñ‹ ÑƒÐ¶Ðµ Ð¼Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÑˆÐ»Ð°, Ð³Ð¾Ñ€Ð´Ð¸ÑÑŒ ÑÐ¾Ð±Ð¾Ð¹ ðŸŒ¹",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ð¸Ð½Ð¾Ð³Ð´Ð° Ð¾Ñ‚Ð´Ñ‹Ñ… â€” ÑÑ‚Ð¾ Ð»ÑƒÑ‡ÑˆÐ¸Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð± Ð±Ñ‹Ñ‚ÑŒ ÑÐ¸Ð»ÑŒÐ½Ð¾Ð¹ ðŸŒ¼",
    "Ð¢Ñ‹ Ð¿Ñ€ÐµÐºÑ€Ð°ÑÐ½Ð° Ñ‚Ð°ÐºÐ¾Ð¹, ÐºÐ°ÐºÐ°Ñ ÐµÑÑ‚ÑŒ ðŸ˜º",
    "ÐŸÑƒÑÑ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ðµ Ñ‡ÑƒÐ´Ð¾ Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ ðŸ’–",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ñ‚Ð²Ð¾Ñ ÑƒÐ»Ñ‹Ð±ÐºÐ° â€” ÑÑ‚Ð¾ ÑÐ¾Ð»Ð½Ñ†Ðµ Ð´Ð»Ñ Ð´Ñ€ÑƒÐ³Ð¸Ñ… ðŸŒ¸",
    "Ð¢Ñ‹ ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð° Ð½Ð° Ð½ÐµÐ²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾Ðµ, Ð¿Ð¾Ð²ÐµÑ€ÑŒ ðŸŒˆ",
    "Ð”Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ Ñ‚ÑÐ¶ÐµÐ»Ð¾, ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑˆÐ°Ð³ â€” ÑÑ‚Ð¾ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ ðŸŒ·",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ð±ÑƒÐ´ÑŒ Ð¼ÑÐ³ÐºÐ¾Ð¹ Ðº ÑÐµÐ±Ðµ, Ñ‚Ñ‹ Ð·Ð°ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°ÐµÑˆÑŒ Ð·Ð°Ð±Ð¾Ñ‚Ñ‹ ðŸ•Šï¸",
    "Ð¢Ñ‹ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð°, Ð¿Ð¾Ð¼Ð½Ð¸ Ð¾Ð± ÑÑ‚Ð¾Ð¼ âœ¨",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ñ‚Ð²Ð¾Ð¹ Ð´ÐµÐ½ÑŒ â€” ÑÑ‚Ð¾ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ°Ñ Ð¿Ð¾Ð±ÐµÐ´Ð° ðŸ’›",
    "Ð¢Ñ‹ ÑÐ²ÐµÑ‚Ð¸ÑˆÑŒ Ð´Ð°Ð¶Ðµ Ð² ÑÐ°Ð¼Ñ‹Ðµ Ð¿Ð°ÑÐ¼ÑƒÑ€Ð½Ñ‹Ðµ Ð´Ð½Ð¸ ðŸŒŸ",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ñ‚Ñ‹ ÑÐ¿Ñ€Ð°Ð²Ð¸ÑˆÑŒÑÑ Ñ ÑÑ‚Ð¸Ð¼, Ñ Ð·Ð½Ð°ÑŽ ðŸ˜º",
    "ÐŸÑƒÑÑ‚ÑŒ Ð»ÑŽÐ±Ð¾Ð²ÑŒ Ðº ÑÐµÐ±Ðµ ÑÑ‚Ð°Ð½ÐµÑ‚ Ñ‚Ð²Ð¾ÐµÐ¹ ÑÐ¸Ð»Ð¾Ð¹ ðŸŒ¸",
    "Ð¢Ñ‹ Ð¿Ñ€ÐµÐºÑ€Ð°ÑÐ½Ð°, Ð´Ð°Ð¶Ðµ ÐºÐ¾Ð³Ð´Ð° ÑÐ¾Ð¼Ð½ÐµÐ²Ð°ÐµÑˆÑŒÑÑ ðŸ’–",
    "Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ð´Ð¾Ð²ÐµÑ€ÑÐ¹ ÑÐ²Ð¾Ð¸Ð¼ Ð¾Ñ‰ÑƒÑ‰ÐµÐ½Ð¸ÑÐ¼ Ð¸ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð°Ð¼ ðŸŒ·",
    "ÐšÐ°Ð¶Ð´Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾ â€” ÑˆÐ°Ð½Ñ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ñ Ñ‡Ð¸ÑÑ‚Ð¾Ð³Ð¾ Ð»Ð¸ÑÑ‚Ð° ðŸŒˆ"
    "Ð¢Ñ‹ ÑÐ°Ð¼Ð¾Ðµ Ñ‚Ñ‘Ð¿Ð»Ð¾Ðµ, Ñ‡Ñ‚Ð¾ ÐµÑÑ‚ÑŒ Ð² Ð¼Ð¾Ñ‘Ð¼ Ð´Ð½Ðµ ðŸŒžðŸ’›",
    "Ð¡ Ñ‚Ð¾Ð±Ð¾Ð¹ Ð´Ð°Ð¶Ðµ Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹ ÑÑ‚Ð°Ð½Ð¾Ð²ÑÑ‚ÑÑ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ñ‹Ð¼Ð¸ ðŸŒ¸âœ¨",
    "ÐœÐ¸Ñ€ Ñ Ñ‚Ð¾Ð±Ð¾Ð¹ Ð¾Ñ‰ÑƒÑ‰Ð°ÐµÑ‚ÑÑ Ð´Ð¾Ð±Ñ€ÐµÐµ ðŸŒˆðŸ’–",
    "Ð¢Ñ‹ Ð´ÐµÐ»Ð°ÐµÑˆÑŒ Ð¼Ð¾ÑŽ Ð¶Ð¸Ð·Ð½ÑŒ ÑÐ²ÐµÑ‚Ð»ÐµÐµ â˜€ï¸ðŸŒ·",
    "Ð£Ð»Ñ‹Ð±ÐºÐ° â€” ÑÑ‚Ð¾ Ñ‚Ð²Ð¾Ñ ÑÑƒÐ¿ÐµÑ€ÑÐ¸Ð»Ð° ðŸ˜ºðŸ’«",
    "Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ ÐµÑÑ‚ÑŒ ðŸ’›ðŸ™",
    "Ð¡ Ñ‚Ð¾Ð±Ð¾Ð¹ Ñ…Ð¾Ñ‡ÐµÑ‚ÑÑ Ð±Ñ‹Ñ‚ÑŒ Ð»ÑƒÑ‡ÑˆÐµ ðŸŒŸðŸ’–",
    "Ð¢Ñ‹ Ð¼Ð¾Ð¹ ÑƒÑŽÑ‚ ðŸ•Šï¸ðŸŒ¿",
    "ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ñ Ñ‚Ð¾Ð±Ð¾Ð¹ ÑÑ‚Ð¾ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ðµ ÑÑ‡Ð°ÑÑ‚ÑŒÐµ ðŸ€ðŸ˜Š",
    "Ð¢Ñ‹ Ð²Ð´Ð¾Ñ…Ð½Ð¾Ð²Ð»ÑÐµÑˆÑŒ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ñ‚ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ñ€ÑÐ´Ð¾Ð¼ ðŸŒ·ðŸ’«",
    "ÐœÐ½Ðµ Ð½Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ ÐµÑÑ‚ÑŒ Ð² ÑÑ‚Ð¾Ð¼ Ð¼Ð¸Ñ€Ðµ ðŸŒ¼ðŸ’›",
    "Ð¡ Ñ‚Ð¾Ð±Ð¾Ð¹ Ð²ÑÑ‘ Ð¾Ñ‰ÑƒÑ‰Ð°ÐµÑ‚ÑÑ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼ ðŸŒŸðŸŒ¸",
    "Ð¢Ñ‹ Ð¼Ð¾Ñ Ð»ÑŽÐ±Ð¾Ð²ÑŒ â¤ï¸ðŸŒˆ",
    "Ð¢Ð²Ð¾Ñ Ð½ÐµÐ¶Ð½Ð¾ÑÑ‚ÑŒ Ð±ÐµÑÑ†ÐµÐ½Ð½Ð° ðŸ’–ðŸ•Šï¸",
    "Ð¢Ñ‹ ÑƒÐ¼ÐµÐµÑˆÑŒ Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð´ÐµÐ½ÑŒ Ñ‚ÐµÐ¿Ð»ÐµÐµ â˜€ï¸ðŸŒ¹",
    "Ð¯ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÐµÐ½ ÑÑƒÐ´ÑŒÐ±Ðµ Ð·Ð° Ñ‚ÐµÐ±Ñ ðŸ™ðŸ’›",
    "Ð¡ Ñ‚Ð¾Ð±Ð¾Ð¹ Ð»ÐµÐ³ÐºÐ¾ Ð¸ ÑÐ¿Ð¾ÐºÐ¾Ð¹Ð½Ð¾ ðŸŒ¿ðŸŒ¸",
    "Ð¢Ñ‹ Ð¼Ð¾Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ ðŸ˜ºâœ¨",
    "Ð”Ð°Ð¶Ðµ ÐºÐ¾Ñ‚Ð¸ÐºÐ¸ Ð·Ð°Ð²Ð¸Ð´ÑƒÑŽÑ‚ Ñ‚Ð²Ð¾ÐµÐ¹ Ð¼Ð¸Ð»Ð¾Ñ‚Ðµ ðŸ±ðŸ’–",
    "Ð¢Ñ‹ ÑƒÐºÑ€Ð°ÑˆÐ°ÐµÑˆÑŒ ÑÑ‚Ð¾Ñ‚ Ð´ÐµÐ½ÑŒ ðŸŒ¸ðŸŒž",
    "ÐœÐ½Ðµ Ð½Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ Ð¾ Ñ‚ÐµÐ±Ðµ ðŸ’›ðŸ’«",
    "Ð¢Ñ‹ Ð»ÑƒÑ‡ÑˆÐµÐµ, Ñ‡Ñ‚Ð¾ ÑÐ¾ Ð¼Ð½Ð¾Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð»Ð¾ÑÑŒ ðŸŒ·â¤ï¸",
    "Ð¡ Ñ‚Ð¾Ð±Ð¾Ð¹ Ñ…Ð¾Ñ‡ÐµÑ‚ÑÑ Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ Ð²ÑÐµÐ¼ ðŸŒˆðŸ’–",
    "Ð¢Ñ‹ Ð´ÐµÐ»Ð°ÐµÑˆÑŒ Ð¼Ð¸Ñ€ Ð¼ÑÐ³Ñ‡Ðµ ðŸŒ¼ðŸ•Šï¸",
    "Ð¢Ñ‹ Ð¼Ð¾Ñ‘ ÑÑ‡Ð°ÑÑ‚ÑŒÐµ â˜€ï¸ðŸ’›",
    "Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ñ‚Ð²Ð¾ÑŽ Ð´Ð¾Ð±Ñ€Ð¾Ñ‚Ñƒ ðŸŒ¸ðŸ™",
    "Ð¡ Ñ‚Ð¾Ð±Ð¾Ð¹ Ð²ÑÐµÐ³Ð´Ð° Ñ‚ÐµÐ¿Ð»Ð¾ ðŸŒžðŸ’–",
    "Ð¢Ñ‹ Ð¾ÑÐ²ÑÑ‰Ð°ÐµÑˆÑŒ ÑÑ‚Ð¾Ñ‚ Ð´ÐµÐ½ÑŒ ðŸŒŸðŸŒ·",
    "Ð¢Ñ‹ Ð´ÐµÐ»Ð°ÐµÑˆÑŒ Ð¼ÐµÐ½Ñ ÑÑ‡Ð°ÑÑ‚Ð»Ð¸Ð²Ñ‹Ð¼ ðŸ˜ºðŸ’«",
    "ÐœÐ½Ðµ Ð¿Ð¾Ð²ÐµÐ·Ð»Ð¾, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ Ñ€ÑÐ´Ð¾Ð¼ ðŸ€â¤ï¸",
    "Ð¢Ñ‹ ÐºÐ°Ðº Ð»ÑƒÑ‡Ð¸Ðº ÑÐ²ÐµÑ‚Ð° â˜€ï¸ðŸŒˆ",
    "Ð¡ Ñ‚Ð¾Ð±Ð¾Ð¹ Ð´Ð°Ð¶Ðµ Ñ‚Ð¸ÑˆÐ¸Ð½Ð° Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð°Ñ ðŸŒ¿âœ¨",
    "Ð¢Ñ‹ Ð¼Ð¾Ñ Ð·Ð°Ð¹ÐºÐ° ðŸ‡ðŸ’›",
    "Ð¯ ÑƒÐ»Ñ‹Ð±Ð°ÑŽÑÑŒ, ÐºÐ¾Ð³Ð´Ð° Ð´ÑƒÐ¼Ð°ÑŽ Ð¾ Ñ‚ÐµÐ±Ðµ ðŸ˜ºðŸ’–",
    "Ð¢Ñ‹ Ð¼Ð¾Ñ‘ Ð²Ð´Ð¾Ñ…Ð½Ð¾Ð²ÐµÐ½Ð¸Ðµ ðŸŒ·ðŸ’«",
    "Ð£Ð»Ñ‹Ð±Ð½Ð¸ÑÑŒ! ðŸ˜ŠðŸŒ¸",
    "ÐœÐ½Ðµ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾, ÐºÐ¾Ð³Ð´Ð° Ñ‚Ñ‹ Ñ€ÑÐ´Ð¾Ð¼ ðŸ•Šï¸â¤ï¸",
    "Ð¢Ñ‹ Ð¼Ð¾Ð¹ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ð¹ Ð¿Ñ€Ð°Ð·Ð´Ð½Ð¸Ðº ðŸŽ‰ðŸ’›",
    "Ð¢Ñ‹ Ð»ÑƒÑ‡ÑˆÐµ Ð²ÑÐµÑ… ðŸŒŸðŸ˜º",
    "ÐÐµ Ð¾Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÑÐ»Ð¾Ð²Ð°Ð¼Ð¸ Ð¼Ð¾ÑŽ Ð»ÑŽÐ±Ð¾Ð²ÑŒ Ðº Ñ‚ÐµÐ±Ðµ ðŸ’–ðŸŒˆ",
    "Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ ðŸ™ðŸŒ¸",
    "Ð¢Ñ‹ Ð¼Ð¾Ñ Ð½ÐµÐ¶Ð½Ð¾ÑÑ‚ÑŒ ðŸŒ·ðŸ’›",
    "Ð¯ Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ ÑÑ‚Ð°Ñ€Ð°ÐµÑˆÑŒÑÑ ðŸ’«ðŸ’–",
    "Ð¢Ñ‹ Ð¼Ð¾Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ ðŸ˜ºðŸŒ¼",
    "Ð¡ Ñ‚Ð¾Ð±Ð¾Ð¹ Ñ…Ð¾Ñ‡ÐµÑ‚ÑÑ ÑƒÐ»Ñ‹Ð±Ð°Ñ‚ÑŒÑÑ ðŸ˜ŠðŸŒŸ"
]
# -----------------------------
# 4ï¸âƒ£ ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° Ñ ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼Ð¸
# -----------------------------
keyboard = [
    ["ÐœÐ¾Ñ‚Ð¸Ð²Ð¸Ñ€ÑƒÑŽÑ‰Ð°Ñ Ñ„Ñ€Ð°Ð·Ð° ðŸŒ¸", "ÐœÐ¸Ð»Ð°Ñ Ñ„Ð¾Ñ‚ÐºÐ° ðŸ¶"],
    ["ÐŸÐ¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ðŸŽ‰", "ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ â„¹ï¸"]
]
reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)

# -----------------------------
# 5ï¸âƒ£ Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð´Ð»Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ Ñ„Ð¾Ñ‚Ð¾
# -----------------------------
last_photo = None

def log_action(user, action):
    conn = sqlite3.connect("stats.db")
    cur = conn.cursor()

    cur.execute("""
        CREATE TABLE IF NOT EXISTS users (
            user_id INTEGER PRIMARY KEY,
            username TEXT,
            first_name TEXT,
            first_seen TEXT,
            last_seen TEXT
        )
    """)

    cur.execute("""
        CREATE TABLE IF NOT EXISTS actions (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER,
            action TEXT,
            timestamp TEXT
        )
    """)

    now = datetime.now().isoformat()

    cur.execute("""
        INSERT INTO users (user_id, username, first_name, first_seen, last_seen)
        VALUES (?, ?, ?, ?, ?)
        ON CONFLICT(user_id) DO UPDATE SET
            last_seen=excluded.last_seen,
            username=excluded.username,
            first_name=excluded.first_name
    """, (
        user.id,
        user.username,
        user.first_name,
        now,
        now
    ))

    cur.execute("""
        INSERT INTO actions (user_id, action, timestamp)
        VALUES (?, ?, ?)
    """, (user.id, action, now))

    conn.commit()
    conn.close()

# -----------------------------
# 6ï¸âƒ£ ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
# -----------------------------
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    global last_photo
    text = update.message.text
    now = datetime.now(timezone.utc) + timedelta(hours=10)  # UTC+10

    if text == "ÐœÐ¾Ñ‚Ð¸Ð²Ð¸Ñ€ÑƒÑŽÑ‰Ð°Ñ Ñ„Ñ€Ð°Ð·Ð° ðŸŒ¸":
        log_action(update.effective_user, "phrase")

        phrase = random.choice(PHRASES)
        await update.message.reply_text(phrase, reply_markup=reply_markup)

    elif text == "ÐœÐ¸Ð»Ð°Ñ Ñ„Ð¾Ñ‚ÐºÐ° ðŸ¶":
        log_action(update.effective_user, "photo")

        photo_path = random.choice(photo_files)
        while photo_path == last_photo and len(photo_files) > 1:
            photo_path = random.choice(photo_files)
        last_photo = photo_path

        await update.message.reply_photo(
            photo=open(os.path.join(PHOTOS_DIR, photo_path), "rb"),
            reply_markup=reply_markup
        )

    elif text == "ÐŸÐ¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ðŸŽ‰":
        log_action(update.effective_user, "congratulation")

        birthday_start = datetime(2026, 1, 24, 0, 0, 0, tzinfo=timezone.utc)
        birthday_end = birthday_start + timedelta(days=1)

        if now < birthday_start:
            await update.message.reply_text(
                "Ð•Ñ‰Ñ‘ Ñ€Ð°Ð½Ð¾ ðŸŽˆ ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð¸ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð´Ð¾ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð´Ð½Ñ!",
                reply_markup=reply_markup
            )
        elif birthday_start <= now < birthday_end:
            await update.message.reply_text(
                "Ð”Ð¾Ñ€Ð¾Ð³Ð°Ñ Ð›ÐµÐ½Ð¾Ñ‡ÐºÐ°, Ð½Ð°ÑÑ‚ÑƒÐ¿Ð¸Ð» Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ. "
                "Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ ÐµÑÑ‚ÑŒ ðŸŽ‰â¤ï¸",
                reply_markup=reply_markup
            )
        else:
            await update.message.reply_text(
                "ÐŸÐ¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑƒÐ¶Ðµ Ð¿Ñ€Ð¾ÑˆÐ»Ð¾, Ð½Ð¾ Ñ‚Ñ‹ Ð²ÑÑ‘ Ñ€Ð°Ð²Ð½Ð¾ Ñ‡ÑƒÐ´Ð¾ ðŸŒ¸",
                reply_markup=reply_markup
            )

    elif text == "ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ â„¹ï¸":
        log_action(update.effective_user, "help")

        help_text = (
            "Ð’Ð¾Ñ‚ Ñ‡Ñ‚Ð¾ Ñ ÑƒÐ¼ÐµÑŽ:\n"
            "ðŸŒ¸ ÐœÐ¾Ñ‚Ð¸Ð²Ð¸Ñ€ÑƒÑŽÑ‰Ð°Ñ Ñ„Ñ€Ð°Ð·Ð° â€” ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð°Ñ Ñ„Ñ€Ð°Ð·Ð°\n"
            "ðŸ¶ ÐœÐ¸Ð»Ð°Ñ Ñ„Ð¾Ñ‚ÐºÐ° â€” Ñ„Ð¾Ñ‚Ð¾ ÐºÐ¾Ñ‚Ð¸ÐºÐ¾Ð² Ð¸ ÑÐ¾Ð±Ð°Ðº\n"
            "ðŸŽ‰ ÐŸÐ¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ â€” Ð¾ÑÐ¾Ð±Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ 24 ÑÐ½Ð²Ð°Ñ€Ñ\n"
            "â„¹ï¸ ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ â€” ÑÑ‚Ð° Ð¿Ð¾Ð´ÑÐºÐ°Ð·ÐºÐ°"
        )
        await update.message.reply_text(help_text, reply_markup=reply_markup)

    else:
        log_action(update.effective_user, "unknown")

        await update.message.reply_text(
            "ÐÐ°Ð¶Ð¸Ð¼Ð°Ð¹ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð²Ð½Ð¸Ð·Ñƒ ðŸ‘‡",
            reply_markup=reply_markup
        )
# -----------------------------
# 7ï¸âƒ£ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
# -----------------------------
app = ApplicationBuilder().token(TOKEN).build()
app.add_handler(CommandHandler("start", start))
app.add_handler(MessageHandler(filters.TEXT & (~filters.COMMAND), handle_message))

# -----------------------------
# 8ï¸âƒ£ Ð—Ð°Ð¿ÑƒÑÐº
# -----------------------------
if __name__ == "__main__":
    print("Ð‘Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½!")
    app.run_polling()



