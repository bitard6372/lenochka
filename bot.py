import os
import random
from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, ContextTypes, MessageHandler, filters

# -----------------------------
# 1๏ธโฃ ะขะพะบะตะฝ
# -----------------------------
TOKEN = os.getenv("TOKEN")
if not TOKEN:
    raise ValueError("ะขะพะบะตะฝ ะฝะต ะฝะฐะนะดะตะฝ! ะัะพะฒะตัั Environment Variables ะฝะฐ Railway")
TOKEN = TOKEN.strip()

# -----------------------------
# 2๏ธโฃ ะะฐะฟะบะฐ ั ัะพัะพะณัะฐัะธัะผะธ
# -----------------------------
PHOTOS_DIR = "photos"
photo_files = os.listdir(PHOTOS_DIR)
photo_files = [f for f in photo_files if f.endswith(".jpg")]
if not photo_files:
    raise ValueError("ะ ะฟะฐะฟะบะต photos ะฝะตั jpg ัะฐะนะปะพะฒ!")
photo_files.sort()

# -----------------------------
# 3๏ธโฃ ะกะฟะธัะพะบ ััะฐะท
# -----------------------------
PHRASES = [
    "ะะตะฝะพัะบะฐ, ัั ะฝะตะฒะตัะพััะฝะฐั, ะฝะต ะทะฐะฑัะฒะฐะน ะพะฑ ััะพะผ ๐ธ",
    "ะััะธ ะณะปัะฑะพะบะพ, ะฒัั ะฝะฐะปะฐะดะธััั, ั ะฒะตัั ะฒ ัะตะฑั โค๏ธ",
    "ะขั ัะธะปัะฝะฐั, ัะผะตะปะฐั ะธ ะทะฐะผะตัะฐัะตะปัะฝะฐั, ะะตะฝะพัะบะฐ ๐",
    "ะะต ะฟะตัะตะถะธะฒะฐะน ัะปะธัะบะพะผ ัะธะปัะฝะพ, ะผะธั ะปัะฑะธั ัะตะฑั ๐ผ",
    "ะะฐะถะดัะน ะดะตะฝั โ ะฝะพะฒะฐั ะฒะพะทะผะพะถะฝะพััั, ะะตะฝะพัะบะฐ โจ",
    "ะขั ะทะฐัะปัะถะธะฒะฐะตัั ััะฐัััั ะธ ัะตะฟะปะฐ, ะฝะต ะทะฐะฑัะฒะฐะน ๐ท",
    "ะะตะฝะพัะบะฐ, ะฟะพะผะฝะธ, ััะพ ัะฒะพะธ ััะฒััะฒะฐ ะฒะฐะถะฝั ะธ ะธั ะผะพะถะฝะพ ะพัะฟัััะธัั ๐",
    "ะขั ะผะพะถะตัั ะฒัั, ััะพ ะทะฐะดัะผะฐะปะฐ, ะฟัะพััะพ ะฟะพะฒะตัั ะฒ ัะตะฑั ๐ซ",
    "ะกะผะตะนัั, ะดะฐะถะต ะตัะปะธ ัะตะณะพะดะฝั ัััะดะฝะพ, ะะตะฝะพัะบะฐ ๐บ",
    "ะขั ะดะตะปะฐะตัั ะผะธั ัััะต, ะฟัะพััะพ ะฑัะดั ัะพะฑะพะน ๐",
    "ะะตะฝะพัะบะฐ, ะฒัั, ััะพ ัะตะฑั ััะตะฒะพะถะธั, ะฟัะพะนะดัั ๐๏ธ",
    "ะะต ัะฟะตัะธ, ะดััะธ ะธ ะดะตะปะฐะน ะผะฐะปะตะฝัะบะธะต ัะฐะณะธ ๐ธ",
    "ะขั ัะถะต ะฟัะพะดะตะปะฐะปะฐ ะพะณัะพะผะฝัั ัะฐะฑะพัั, ะะตะฝะพัะบะฐ ๐",
    "ะัะฑะพะน ััะพัะผ ะทะฐะบะฐะฝัะธะฒะฐะตััั, ะธ ัะพะปะฝัะต ะพะฑัะทะฐัะตะปัะฝะพ ะฒัะนะดะตั โ๏ธ",
    "ะะตะฝะพัะบะฐ, ะทะฝะฐะน: ัะฒะพั ะดะพะฑัะพัะฐ ะดะตะปะฐะตั ััะพั ะผะธั ะปัััะต ๐",
    "ะขั ัะผะตะตัั ัะฟัะฐะฒะปััััั ั ัััะดะฝะพัััะผะธ, ะดะฐะถะต ะตัะปะธ ัะตะนัะฐั ััะถะตะปะพ ๐ท",
    "ะะพะทะฒะพะปั ัะตะฑะต ะพัะดะพัะฝััั ะธ ัะปัะฑะฝััััั ๐",
    "ะะตะฝะพัะบะฐ, ัั ะทะฐัะปัะถะธะฒะฐะตัั ะปัะฑะฒะธ ะธ ะทะฐะฑะพัั ๐น",
    "ะะฐะถะดะพะต ัะฒะพะต ััะฒััะฒะพ ะฒะฐะถะฝะพ, ะฝะต ะฟะพะดะฐะฒะปัะน ะตะณะพ ๐",
    "ะขั ะฝะต ะพะดะฝะฐ, ะผะธั ะธ ั ั ัะพะฑะพะน ๐",
    "ะะตะฝะพัะบะฐ, ัะตะณะพะดะฝั ัะพัะพัะธะน ะดะตะฝั ะดะปั ะผะฐะปะตะฝัะบะพะน ัะฐะดะพััะธ ๐",
    "ะขั ัะฐะปะฐะฝัะปะธะฒะฐ, ัะผะฝะฐ ะธ ะฟัะตะบัะฐัะฝะฐ ๐",
    "ะะต ะฑะพะนัั ะพัะธะฑะพะบ, ะพะฝะธ ะดะตะปะฐัั ัะตะฑั ัะธะปัะฝะตะต ๐ซ",
    "ะะตะฝะพัะบะฐ, ัะปัะฑะฝะธัั, ะดะฐะถะต ะผะฐะปะตะฝัะบะฐั ัะปัะฑะบะฐ โ ััะพ ะผะฐะณะธั ๐บ",
    "ะขั ัะฟะพัะพะฑะฝะฐ ะฝะฐ ะฑะพะปััะตะต, ัะตะผ ะดัะผะฐะตัั ๐ผ",
    "ะัั ะฑัะดะตั ัะพัะพัะพ, ะฟัะพััะพ ะดะพะฒะตััะน ัะตะฑะต ๐ท",
    "ะะตะฝะพัะบะฐ, ัั ัะดะธะฒะธัะตะปัะฝะฐั, ะฝะต ัะพะผะฝะตะฒะฐะนัั ๐ธ",
    "ะัััั ัะตะณะพะดะฝั ะฑัะดะตั ะผะธะฝััะบะฐ ะฟะพะบะพั ะธ ัะตะฟะปะฐ ๐",
    "ะขั ัะผะตะตัั ัะฟัะฐะฒะปััััั ั ะปัะฑัะผะธ ะฑัััะผะธ, ะะตะฝะพัะบะฐ ๐๏ธ",
    "ะะพะผะฝะธ, ััะพ ะผะฐะปะตะฝัะบะธะต ะฟะพะฑะตะดั โ ััะพ ัะพะถะต ััะฟะตั ๐",
    "ะะตะฝะพัะบะฐ, ะฟะพะทะฒะพะปั ัะตะฑะต ะฟะพััะฒััะฒะพะฒะฐัั ัะฐะดะพััั ัะตะณะพะดะฝั ๐",
    "ะขั ะดะพััะพะนะฝะฐ ัะฐะผัั ััะฟะปัั ัะปะพะฒ ะธ ะพะฑัััะธะน ๐",
    "ะะฐะถะต ะฒ ัััะดะฝัะต ะผะพะผะตะฝัั ัั ะพััะฐััััั ะฟัะตะบัะฐัะฝะพะน ๐ท",
    "ะะตะฝะพัะบะฐ, ัะฒะพั ัะฝะตัะณะธั ะดะตะปะฐะตั ััะพั ะผะธั ัะฒะตัะปะตะต โจ",
    "ะะพะฒะตััะน ัะตะฑะต, ัั ะฒัั ัะผะพะถะตัั ๐ซ",
    "ะขั ัะถะต ะผะฝะพะณะพ ะฟัะพัะปะฐ, ะณะพัะดะธัั ัะพะฑะพะน ๐น",
    "ะะตะฝะพัะบะฐ, ะธะฝะพะณะดะฐ ะพัะดัั โ ััะพ ะปัััะธะน ัะฟะพัะพะฑ ะฑััั ัะธะปัะฝะพะน ๐ผ",
    "ะขั ะฟัะตะบัะฐัะฝะฐ ัะฐะบะพะน, ะบะฐะบะฐั ะตััั ๐บ",
    "ะัััั ัะตะณะพะดะฝั ะฑัะดะตั ะผะฐะปะตะฝัะบะพะต ััะดะพ ะดะปั ัะตะฑั ๐",
    "ะะตะฝะพัะบะฐ, ัะฒะพั ัะปัะฑะบะฐ โ ััะพ ัะพะปะฝัะต ะดะปั ะดััะณะธั ๐ธ",
    "ะขั ัะฟะพัะพะฑะฝะฐ ะฝะฐ ะฝะตะฒะตัะพััะฝะพะต, ะฟะพะฒะตัั ๐",
    "ะะฐะถะต ะตัะปะธ ััะถะตะปะพ, ะบะฐะถะดัะน ัะฐะณ โ ััะพ ะฟัะพะณัะตัั ๐ท",
    "ะะตะฝะพัะบะฐ, ะฑัะดั ะผัะณะบะพะน ะบ ัะตะฑะต, ัั ะทะฐัะปัะถะธะฒะฐะตัั ะทะฐะฑะพัั ๐๏ธ",
    "ะขั ัะฝะธะบะฐะปัะฝะฐ, ะฟะพะผะฝะธ ะพะฑ ััะพะผ โจ",
    "ะะตะฝะพัะบะฐ, ะบะฐะถะดัะน ัะฒะพะน ะดะตะฝั โ ััะพ ะผะฐะปะตะฝัะบะฐั ะฟะพะฑะตะดะฐ ๐",
    "ะขั ัะฒะตัะธัั ะดะฐะถะต ะฒ ัะฐะผัะต ะฟะฐัะผััะฝัะต ะดะฝะธ ๐",
    "ะะตะฝะพัะบะฐ, ัั ัะฟัะฐะฒะธัััั ั ััะธะผ, ั ะทะฝะฐั ๐บ",
    "ะัััั ะปัะฑะพะฒั ะบ ัะตะฑะต ััะฐะฝะตั ัะฒะพะตะน ัะธะปะพะน ๐ธ",
    "ะขั ะฟัะตะบัะฐัะฝะฐ, ะดะฐะถะต ะบะพะณะดะฐ ัะพะผะฝะตะฒะฐะตัััั ๐",
    "ะะตะฝะพัะบะฐ, ะดะพะฒะตััะน ัะฒะพะธะผ ะพัััะตะฝะธัะผ ะธ ััะฒััะฒะฐะผ ๐ท",
    "ะะฐะถะดะพะต ัััะพ โ ัะฐะฝั ะฝะฐัะฐัั ั ัะธััะพะณะพ ะปะธััะฐ ๐"
    "ะขั ัะฐะผะพะต ััะฟะปะพะต, ััะพ ะตััั ะฒ ะผะพัะผ ะดะฝะต ๐๐",
    "ะก ัะพะฑะพะน ะดะฐะถะต ะพะฑััะฝัะต ะผะพะผะตะฝัั ััะฐะฝะพะฒัััั ะพัะพะฑะตะฝะฝัะผะธ ๐ธโจ",
    "ะะธั ั ัะพะฑะพะน ะพัััะฐะตััั ะดะพะฑัะตะต ๐๐",
    "ะขั ะดะตะปะฐะตัั ะผะพั ะถะธะทะฝั ัะฒะตัะปะตะต โ๏ธ๐ท",
    "ะฃะปัะฑะบะฐ โ ััะพ ัะฒะพั ััะฟะตััะธะปะฐ ๐บ๐ซ",
    "ะกะฟะฐัะธะฑะพ, ััะพ ัั ะตััั ๐๐",
    "ะก ัะพะฑะพะน ัะพัะตััั ะฑััั ะปัััะต ๐๐",
    "ะขั ะผะพะน ััั ๐๏ธ๐ฟ",
    "ะะฐะถะดัะน ะดะตะฝั ั ัะพะฑะพะน ััะพ ะผะฐะปะตะฝัะบะพะต ััะฐัััะต ๐๐",
    "ะขั ะฒะดะพัะฝะพะฒะปัะตัั ะฟัะพััะพ ัะตะผ, ััะพ ััะดะพะผ ๐ท๐ซ",
    "ะะฝะต ะฝัะฐะฒะธััั, ััะพ ัั ะตััั ะฒ ััะพะผ ะผะธัะต ๐ผ๐",
    "ะก ัะพะฑะพะน ะฒัั ะพัััะฐะตััั ะฟัะฐะฒะธะปัะฝัะผ ๐๐ธ",
    "ะขั ะผะพั ะปัะฑะพะฒั โค๏ธ๐",
    "ะขะฒะพั ะฝะตะถะฝะพััั ะฑะตััะตะฝะฝะฐ ๐๐๏ธ",
    "ะขั ัะผะตะตัั ะดะตะปะฐัั ะดะตะฝั ัะตะฟะปะตะต โ๏ธ๐น",
    "ะฏ ะฑะปะฐะณะพะดะฐัะตะฝ ััะดัะฑะต ะทะฐ ัะตะฑั ๐๐",
    "ะก ัะพะฑะพะน ะปะตะณะบะพ ะธ ัะฟะพะบะพะนะฝะพ ๐ฟ๐ธ",
    "ะขั ะผะพั ัะฐะดะพััั ๐บโจ",
    "ะะฐะถะต ะบะพัะธะบะธ ะทะฐะฒะธะดััั ัะฒะพะตะน ะผะธะปะพัะต ๐ฑ๐",
    "ะขั ัะบัะฐัะฐะตัั ััะพั ะดะตะฝั ๐ธ๐",
    "ะะฝะต ะฝัะฐะฒะธััั ะดัะผะฐัั ะพ ัะตะฑะต ๐๐ซ",
    "ะขั ะปัััะตะต, ััะพ ัะพ ะผะฝะพะน ัะปััะฐะปะพัั ๐ทโค๏ธ",
    "ะก ัะพะฑะพะน ัะพัะตััั ะดะตะปะธัััั ะฒัะตะผ ๐๐",
    "ะขั ะดะตะปะฐะตัั ะผะธั ะผัะณัะต ๐ผ๐๏ธ",
    "ะขั ะผะพั ััะฐัััะต โ๏ธ๐",
    "ะกะฟะฐัะธะฑะพ ะทะฐ ัะฒะพั ะดะพะฑัะพัั ๐ธ๐",
    "ะก ัะพะฑะพะน ะฒัะตะณะดะฐ ัะตะฟะปะพ ๐๐",
    "ะขั ะพัะฒััะฐะตัั ััะพั ะดะตะฝั ๐๐ท",
    "ะขั ะดะตะปะฐะตัั ะผะตะฝั ััะฐััะปะธะฒัะผ ๐บ๐ซ",
    "ะะฝะต ะฟะพะฒะตะทะปะพ, ััะพ ัั ััะดะพะผ ๐โค๏ธ",
    "ะขั ะบะฐะบ ะปััะธะบ ัะฒะตัะฐ โ๏ธ๐",
    "ะก ัะพะฑะพะน ะดะฐะถะต ัะธัะธะฝะฐ ะฟัะธััะฝะฐั ๐ฟโจ",
    "ะขั ะผะพั ะทะฐะนะบะฐ ๐๐",
    "ะฏ ัะปัะฑะฐััั, ะบะพะณะดะฐ ะดัะผะฐั ะพ ัะตะฑะต ๐บ๐",
    "ะขั ะผะพั ะฒะดะพัะฝะพะฒะตะฝะธะต ๐ท๐ซ",
    "ะฃะปัะฑะฝะธัั! ๐๐ธ",
    "ะะฝะต ัะพัะพัะพ, ะบะพะณะดะฐ ัั ััะดะพะผ ๐๏ธโค๏ธ",
    "ะขั ะผะพะน ะผะฐะปะตะฝัะบะธะน ะฟัะฐะทะดะฝะธะบ ๐๐",
    "ะขั ะปัััะต ะฒัะตั ๐๐บ",
    "ะะต ะพะฟะธัะฐัั ัะปะพะฒะฐะผะธ ะผะพั ะปัะฑะพะฒั ะบ ัะตะฑะต ๐๐",
    "ะกะฟะฐัะธะฑะพ ๐๐ธ",
    "ะขั ะผะพั ะฝะตะถะฝะพััั ๐ท๐",
    "ะฏ ะทะฝะฐั, ััะพ ัั ััะฐัะฐะตัััั ๐ซ๐",
    "ะขั ะผะพั ัะฐะดะพััั ะบะฐะถะดัะน ะดะตะฝั ๐บ๐ผ",
    "ะก ัะพะฑะพะน ัะพัะตััั ัะปัะฑะฐัััั ๐๐"
]

# -----------------------------
# 4๏ธโฃ ะะปะฐะฒะธะฐัััะฐ ั ะบะฝะพะฟะบะฐะผะธ
# -----------------------------
keyboard = [
    ["ะะพัะธะฒะธััััะฐั ััะฐะทะฐ ๐ธ", "ะะธะปะฐั ัะพัะบะฐ ๐ถ"],
    ["ะะพะผะพัั โน๏ธ"]
]
reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)

# -----------------------------
# 5๏ธโฃ ะะฑัะฐะฑะพััะธะบะธ ัะพะพะฑัะตะฝะธะน
# -----------------------------
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "ะัะธะฒะตั! ะฏ ัะฒะพะน ะผะฐะปะตะฝัะบะธะน ะดััะถะพะบ ั ะผะธะปัะผะธ ััะฐะทะฐะผะธ ะธ ัะพัะพ ๐ถ๐ธ\n"
        "ะะฐะถะธะผะฐะน ะฝะฐ ะบะฝะพะฟะบะธ ะฒะฝะธะทั, ััะพะฑั ะฟะพะปััะฐัั ะผะพัะธะฒะฐัะธั, ัะพัะบะธ ะธ ะฟะพะทะดัะฐะฒะปะตะฝะธะต ๐.",
        reply_markup=reply_markup
    )

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = update.message.text
    now = datetime.now(timezone.utc) + timedelta(hours=TIMEZONE_OFFSET)

    if text == "ะะพัะธะฒะธััััะฐั ััะฐะทะฐ ๐ธ":
        phrase = random.choice(PHRASES)
        await update.message.reply_text(phrase, reply_markup=reply_markup)
    elif text == "ะะธะปะฐั ัะพัะบะฐ ๐ถ":
        photo_path = os.path.join(PHOTOS_DIR, random.choice(photo_files))
        await update.message.reply_photo(photo=open(photo_path, "rb"), reply_markup=reply_markup)
    elif text == "ะะพะทะดัะฐะฒะปะตะฝะธะต ๐":
        if now < BIRTHDAY_DATE:
            await update.message.reply_text(
                "ะัั ัะฐะฝะพ ๐ ะะพะดะพะถะดะธ ะฝะตะผะฝะพะณะพ ะดะพ ะพัะพะฑะตะฝะฝะพะณะพ ะดะฝั!",
                reply_markup=reply_markup
            )
        elif BIRTHDAY_DATE <= now < BIRTHDAY_DATE + timedelta(days=1):
            await update.message.reply_text(
                "ะะพัะพะณะฐั ะะตะฝะพัะบะฐ, ะฝะฐัััะฟะธะป ะพัะพะฑะตะฝะฝัะน ะดะตะฝั, ะบะพัะพััะน ัะพะปัะบะพ ะดะปั ัะตะฑั. ะกะฟะฐัะธะฑะพ, ััะพ ัั ะตััั ๐โค๏ธ",
                reply_markup=reply_markup
            )
        else:
            await update.message.reply_text(
                "ะะพะทะดัะฐะฒะปะตะฝะธะต ัะถะต ะฟัะพัะปะพ, ะฝะพ ัั ะฒัั ัะฐะฒะฝะพ ััะดะพ ๐ธ",
                reply_markup=reply_markup
            )
    elif text == "ะะพะผะพัั โน๏ธ":
        help_text = (
            "ะะพั ััะพ ั ัะผะตั:\n"
            "๐ธ ะะพัะธะฒะธััััะฐั ััะฐะทะฐ โ ะฟัะธััะปะฐั ัะปััะฐะนะฝัั ะผะพัะธะฒะฐัะธั\n"
            "๐ถ ะะธะปะฐั ัะพัะบะฐ โ ะฟัะธััะปะฐั ัะพัะพ ัะพะฑะฐะบ\n"
            "๐ ะะพะทะดัะฐะฒะปะตะฝะธะต โ ัะฟะตัะธะฐะปัะฝะพะต ัะพะพะฑัะตะฝะธะต ะดะปั ะะตะฝั (24 ัะฝะฒะฐัั)\n"
            "โน๏ธ ะะพะผะพัั โ ััะฐ ะฟะพะดัะบะฐะทะบะฐ"
        )
        await update.message.reply_text(help_text, reply_markup=reply_markup)
    else:
        await update.message.reply_text(
            "ะะฐะถะธะผะฐะน ะฝะฐ ะบะฝะพะฟะบะธ ะฒะฝะธะทั, ััะพะฑั ะฟะพะปััะธัั ะผะพัะธะฒะฐัะธั, ัะพัะพ ะธะปะธ ะฟะพะทะดัะฐะฒะปะตะฝะธะต ๐",
            reply_markup=reply_markup
        )

# -----------------------------
# 7๏ธโฃ ะะฐัััะพะนะบะฐ ะฟัะธะปะพะถะตะฝะธั
# -----------------------------
app = ApplicationBuilder().token(TOKEN).build()
app.add_handler(CommandHandler("start", start))
app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

# -----------------------------
# 8๏ธโฃ ะะฐะฟััะบ
# -----------------------------
if __name__ == "__main__":
    print("ะะพั ะทะฐะฟััะตะฝ!")
    app.run_polling()



